graph TD
    Start([ğŸ’¬ User Question]) --> Classify[ğŸ¯ Step 1: Query Classification]
    
    Classify --> Type{Query Type?}
    
    Type --> Casual[ğŸ˜Š CASUAL<br/>Greetings, thanks, etc.]
    Type --> Memory[ğŸ§  MEMORY<br/>Previous conversation]
    Type --> Document[ğŸ“„ DOCUMENT<br/>Needs database search]
    
    Casual --> FastResponse[âš¡ Fast Response<br/>No preprocessing needed]
    Memory --> SessionHistory[ğŸ“‹ Check Session History<br/>Last 10 messages]
    
    Document --> Mode[ğŸ¨ Step 2: Mode Detection]
    
    Mode --> M1["detail - 15 docs, 400-600 words"]
    Mode --> M2["normal - 7 docs, 150-250 words"]
    Mode --> M3["short - 3 docs, 30-80 words"]
    
    M1 --> Intent
    M2 --> Intent
    M3 --> Intent[ğŸ” Step 3: Intent Detection]
    
    Intent --> I1[explain - Define/describe]
    Intent --> I2[compare - Differences/vs]
    Intent --> I3[list - Show me/give me]
    Intent --> I4[summarize - Overview/brief]
    Intent --> I5[howto - Steps/process]
    Intent --> I6[factual - When/where/who]
    
    I1 --> Enhance
    I2 --> Enhance
    I3 --> Enhance
    I4 --> Enhance
    I5 --> Enhance
    I6 --> Enhance[âœ¨ Step 4: Query Enhancement]
    
    Enhance --> Sub[ğŸ“ Decompose Complex Query]
    
    Sub --> SubEx1["Original: 'What is ML and how does it work?'"]
    SubEx1 --> SubEx2["Sub-query 1: 'What is ML'"]
    SubEx1 --> SubEx3["Sub-query 2: 'how does it work'"]
    SubEx1 --> SubEx4["Sub-query 3: 'machine learning process'"]
    
    SubEx2 --> Var
    SubEx3 --> Var
    SubEx4 --> Var[ğŸ”„ Generate Search Variations]
    
    Var --> V1["Variation 1: Original query"]
    Var --> V2["Variation 2: 'what is [topic]'"]
    Var --> V3["Variation 3: 'explain [topic]'"]
    Var --> V4["Variation 4: Remove question words"]
    
    V1 --> Syn
    V2 --> Syn
    V3 --> Syn
    V4 --> Syn[ğŸ“š Synonym Expansion<br/>Using WordNet]
    
    Syn --> SynEx["'ML' â†’ 'machine learning'<br/>'process' â†’ 'method, procedure'<br/>'work' â†’ 'function, operate'"]
    
    SynEx --> Hyp[ğŸ“„ Hypothetical Document<br/>Create expected answer template]
    
    Hyp --> HypEx["Template: '[Topic] is a concept that<br/>refers to [description]. It involves<br/>[aspects] and is used in [context].'"]
    
    HypEx --> Entity[ğŸ·ï¸ Extract Entities<br/>Capitalized phrases]
    
    Entity --> EntEx["Example: 'Machine Learning'<br/>'Neural Networks', 'Data Science'"]
    
    EntEx --> KeyTerms[ğŸ”‘ Extract Key Terms<br/>Remove stopwords, 4+ letters]
    
    KeyTerms --> KTEx["'machine', 'learning', 'process'<br/>'algorithm', 'training', 'model'"]
    
    KTEx --> Final[âœ… Step 5: Final Query Package]
    
    Final --> Output1[Original Query]
    Final --> Output2[5-7 Sub-queries]
    Final --> Output3[5 Search Variations]
    Final --> Output4[Synonym-expanded terms]
    Final --> Output5[Hypothetical document]
    Final --> Output6[Key entities & terms]
    
    Output1 --> Ready
    Output2 --> Ready
    Output3 --> Ready
    Output4 --> Ready
    Output5 --> Ready
    Output6 --> Ready[(ğŸ¯ Ready for Retrieval<br/>7-10 enhanced queries<br/>Maximum coverage)]
    
    Ready --> Tech[ğŸ”§ Technical Tools Used]
    Tech --> T1[NLTK - Stopwords & WordNet]
    Tech --> T2[Regex - Pattern matching]
    Tech --> T3[Question Patterns - Template matching]
    Tech --> T4[Collections Counter - Frequency analysis]
    
    style Start fill:#e3f2fd
    style Classify fill:#fff9c4
    style Casual fill:#c8e6c9
    style Memory fill:#c8e6c9
    style Document fill:#c8e6c9
    style Mode fill:#f8bbd0
    style Intent fill:#ffccbc
    style Enhance fill:#b39ddb
    style Sub fill:#ce93d8
    style Var fill:#ba68c8
    style Syn fill:#ab47bc
    style Hyp fill:#9c27b0
    style Entity fill:#8e24aa
    style KeyTerms fill:#7b1fa2
    style Final fill:#80deea
    style Ready fill:#a5d6a7
    style Tech fill:#90a4ae
    
    style I1 fill:#ffab91
    style I2 fill:#ffab91
    style I3 fill:#ffab91
    style I4 fill:#ffab91
    style I5 fill:#ffab91
    style I6 fill:#ffab91